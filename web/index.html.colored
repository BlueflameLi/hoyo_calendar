<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ICS Calendar</title>
  <link href="https://cdn.jsdelivr.net/npm/fullcalendar@5.11.0/main.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/fullcalendar@5.11.0/main.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/ical.js/1.4.0/ical.min.js"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
    }
    #calendar {
      max-width: 1100px;
      margin: 40px auto;
    }
  </style>
</head>
<body>

<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ICS Calendar</title>
  <link href="https://cdn.jsdelivr.net/npm/fullcalendar@5.11.0/main.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/fullcalendar@5.11.0/main.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/ical.js/1.4.0/ical.min.js"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
    }
    #calendar {
      max-width: 1100px;
      margin: 40px auto;
    }
  </style>
</head>
<body>

<div id="calendar"></div>

<script>
  document.addEventListener('DOMContentLoaded', function () {
    // 初始化FullCalendar
    var calendarEl = document.getElementById('calendar');
    var calendar = new FullCalendar.Calendar(calendarEl, {
      initialView: 'dayGridMonth',
      events: []
    });
    calendar.render();

    // 加载多个ICS文件
    function loadICS(urls) {
      urls.forEach(url => {
        fetch(url)
          .then(response => response.text())
          .then(data => {
            let jcalData = ICAL.parse(data);
            let comp = new ICAL.Component(jcalData);
            let events = comp.getAllSubcomponents('vevent');

            events.forEach(event => {
              let summary = event.getFirstPropertyValue('summary');
              let startDate = event.getFirstPropertyValue('dtstart').toJSDate();
              let endDate = event.getFirstPropertyValue('dtend') ? event.getFirstPropertyValue('dtend').toJSDate() : startDate;

              // 根据summary获取颜色
              let eventColor = summaryToColor(summary);

              // 添加活动到FullCalendar
              calendar.addEvent({
                title: summary,
                start: startDate,
                end: endDate,
                color: eventColor
              });
            });
          })
          .catch(error => console.error('Error loading ICS file:', error));
      });
    }

    // 根据不同的summary返回不同的颜色
    function summaryToColor(summary) {
  // 生成hash值
  let hash = 0;
  for (let i = 0; i < summary.length; i++) {
    hash = summary.charCodeAt(i) + ((hash << 5) - hash);
  }
  // 将 hash 值转换为颜色值
  let color = '#';
  for (let i = 0; i < 3; i++) {
    let value = (hash >> (i * 8)) & 0xFF;
    color += ('00' + value.toString(16)).substr(-2);
  }
	return color;
    }

    // 示例：加载多个ICS文件
    loadICS([
      'https://raw.gitmirror.com/Trrrrw/hoyo_calendar/main/ics/continuous/%E5%8E%9F%E7%A5%9E.ics',
      'https://raw.gitmirror.com/Trrrrw/hoyo_calendar/main/ics/continuous/%E6%98%9F%E9%93%81.ics',
      'https://raw.gitmirror.com/Trrrrw/hoyo_calendar/main/ics/continuous/%E7%BB%9D%E5%8C%BA%E9%9B%B6.ics'
    ]);
  });
</script>

</body>
</html>

